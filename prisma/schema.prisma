// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Role {
  id        String   @id @default(uuid())
  name      String   @unique
  label     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  users     User[]
}

model User {
  id                String    @id @default(uuid())
  firstName         String
  lastName          String
  pseudo            String    @unique
  picture           String?
  phone             String
  email             String    @unique
  password          String
  otp               String?
  tokenNotification String?
  otpExpiresAt      DateTime?
  emailVerifiedAt   DateTime?
  lastEmailSentAt   DateTime?
  assetRemaining    Int       @default(2)
  isActive          Boolean   @default(true)
  isVerified        Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  role              Role      @relation(fields: [roleId], references: [id])
  roleId            String
  assets            Asset[]
  assetsRetrouve    Asset[]   @relation("RetrouveBy")
  alerte            Alerte[]
  signal            Signal[]
  notification      Notification[]
  donation          Donation[]
  userSubscription UserSubscription[]
}

model Category {
  id        String   @id @default(uuid())
  image     String
  slug      String   @unique
  name      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  assets    Asset[]
}

enum AssetStatus {
  AVAILABLE
  THEFT
  LOST
  RETROUVE
}

model Asset {
  id           String      @id @default(uuid())
  images       String[]
  invoices     String[]
  data         Json
  status       AssetStatus @default(AVAILABLE)
  latitude     Float?
  longitude    Float?
  isVerified   Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  retrouveAt   DateTime?
  retrouveBy   User?       @relation("RetrouveBy", fields: [retrouveById], references: [id])
  retrouveById String?
  category     Category    @relation(fields: [categoryId], references: [id])
  categoryId   String
  user         User        @relation(fields: [userId], references: [id])
  userId       String
  alerte       Alerte[]
  signal       Signal[]
  notification Notification[]
}

model Alerte {
  id           String   @id @default(uuid())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  asset        Asset    @relation(fields: [assetId], references: [id])
  assetId      String
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  motif        String
  circonstance String?
  status       Boolean  @default(false)
  date         DateTime
  heure        DateTime
  place        String
  plaintNumber String?
}

model Signal {
  id           String   @id @default(uuid())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  place        String
  latitude     Float?
  longitude    Float?  
  date         DateTime
  heure        DateTime
  assetImages  String[] @default([])
  placeImages  String[] @default([])
  asset        Asset    @relation(fields: [assetId], references: [id])
  assetId      String
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  circonstance String?
  status       Boolean  @default(false)
}

model Notification {
  id           String   @id @default(uuid())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  title        String
  message      String
  isRead       Boolean   @default(false)
  status       Boolean   @default(false)
  asset        Asset?    @relation(fields: [assetId], references: [id])
  assetId      String?
}

model Donation {
  id           String   @id @default(uuid())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now())
  email        String?
  phone        String?
  name         String?
  amount       Float
  user         User?     @relation(fields: [userId], references: [id])
  userId       String?
  status       Boolean   @default(false)
  transactionId String?
} 

model Subscription {
  id           String   @id @default(uuid())
  assetRemaining Int
  price Float
  status Boolean   @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now())
  userSubscription UserSubscription[]
}

model UserSubscription {
  id           String   @id @default(uuid())
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  subscription Subscription @relation(fields: [subscriptionId], references: [id])
  subscriptionId String
  transactionId String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now())
}
